# Grafana mysql 后台任意文件读取漏洞 CVE-2019-19499

## 漏洞描述

Grafana 是一个用于分析、监控和数据可视化的开源应用程序。数以千计的公司使用 Grafana，包括 PayPal、eBay 和 Intel 等主要代表。通过登录后台设置Mysql可以读取服务器中的任意文件

## 漏洞影响

<a-checkbox checked>Grafana < 6.4.4</a-checkbox></br>

## 环境搭建

```sh
docker pull grafana/grafana:6.4.3 
docker run -d --name=grafana -p 3000:3000 grafana/grafana:6.4.3 
```

## 漏洞复现

登录后台 admin/admin, 添加数据源 Mysql

![img](../../../.vuepress/public/img/1651028841683-f01b58e6-4274-4074-82b6-0b4f05c87475.png)

[修复漏洞参考](https://github.com/grafana/grafana/pull/20192/files)

![img](../../../.vuepress/public/img/1651028825347-5151f68b-125c-4334-830e-4b4282df4b09.png)

修复部分为 database数据库名的用户可控部分，由于 allowAllFiles=true 参数可以禁用对 LOCAL INFILE 请求的保护，再通过之前有关Mysql任意文件读取的漏洞即可获取服务器中的任意文件

![img](../../../.vuepress/public/img/1651029262386-e799b54d-5d9f-4d63-8a95-e74b729ba966.png)

再创建一个恶意Mysql： [https://github.com/allyshka/Rogue-MySql-Server](https://github.com/allyshka/Rogue-MySql-Server)

![img](../../../.vuepress/public/img/1651029326354-a2d6830f-8087-4c6f-a295-e94964b8877e.png)

执行 Save 即可读取文件

![img](../../../.vuepress/public/img/1651029367812-9d8bcfc1-201d-4343-a1ca-fd97686cd3b9.png)