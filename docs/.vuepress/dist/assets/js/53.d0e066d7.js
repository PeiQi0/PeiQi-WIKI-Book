(window.webpackJsonp=window.webpackJsonp||[]).push([[53],{2430:function(s,a,t){s.exports=t.p+"assets/img/1650592340016-fcbc91f2-5443-4dd3-b726-5fabfe109617.d1947afc.png"},2431:function(s,a,t){s.exports=t.p+"assets/img/1650592523770-e6ea155d-4e62-426a-82d1-c9acd7359846.7bb8d368.png"},2432:function(s,a,t){s.exports=t.p+"assets/img/1650592654329-a18480bd-82f4-41df-bdb5-d99056a6637a.f45a8599.png"},2433:function(s,a,t){s.exports=t.p+"assets/img/1650592691209-1c8ccadd-47d7-4c67-9cbe-4a6f74738957.3737493f.png"},2434:function(s,a,t){s.exports=t.p+"assets/img/1650592955431-233dff33-a8c7-4d6f-a149-472005e5aee5.9c41429d.png"},2435:function(s,a,t){s.exports=t.p+"assets/img/1650593267061-cc90dfbe-c500-42a8-813c-f76d13383367.c6a18441.png"},3044:function(s,a,t){"use strict";t.r(a);var n=t(75),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"apache-skywalking-graphql-sql注入漏洞-cve-2020-9483"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#apache-skywalking-graphql-sql注入漏洞-cve-2020-9483"}},[s._v("#")]),s._v(" Apache SkyWalking graphql SQL注入漏洞 CVE-2020-9483")]),s._v(" "),n("h2",{attrs:{id:"漏洞描述"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#漏洞描述"}},[s._v("#")]),s._v(" 漏洞描述")]),s._v(" "),n("p",[s._v("腾讯安全威胁情报中心监测到Apache SkyWalking发布更新，修复了一个SQL注入漏洞（编号：CVE-2020-9483）。远程攻击者可通过Apache SkyWalking默认开放的未授权GraphQL接口构造恶意请求包进行注入攻击，成功利用此漏洞可造成敏感数据泄漏。该漏洞等级为高危，腾讯安全专家建议相关企业尽快修复。")]),s._v(" "),n("h2",{attrs:{id:"漏洞影响"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#漏洞影响"}},[s._v("#")]),s._v(" 漏洞影响")]),s._v(" "),n("a-checkbox",{attrs:{checked:""}},[s._v("Apache SkyWalking 6.0.0~6.6.0")]),n("br"),s._v(" "),n("a-checkbox",{attrs:{checked:""}},[s._v("Apache SkyWalking 7.0.0")]),n("br"),s._v(" "),n("h2",{attrs:{id:"环境搭建"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#环境搭建"}},[s._v("#")]),s._v(" 环境搭建")]),s._v(" "),n("a-checkbox",{attrs:{checked:""}},[s._v("https://archive.apache.org/dist/skywalking/6.5.0/apache-skywalking-apm-6.5.0.tar.gz")]),n("br"),s._v(" "),n("a-checkbox",{attrs:{checked:""}},[s._v("https://archive.apache.org/dist/skywalking/8.3.0/apache-skywalking-apm-6.5.0-src.tgz")]),n("br"),s._v(" "),n("h2",{attrs:{id:"漏洞复现"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#漏洞复现"}},[s._v("#")]),s._v(" 漏洞复现")]),s._v(" "),n("p",[s._v("下载编译好的源码后，进入bin目录，修改 oapService.sh  通过IDEA进行远程调试")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("i")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$OAP_HOME")]),s._v('"')]),s._v("/oap-libs/*.jar\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CLASSPATH")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$i")]),s._v(":"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CLASSPATH")]),s._v('"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("OAP_OPTIONS")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('" -Doap.logDir='),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${OAP_LOG_DIR}")]),s._v('"')]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("eval")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$_RUNJAVA")]),n("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_OPTS}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${OAP_OPTIONS}")]),s._v(" -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5005 -classpath "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CLASSPATH")]),s._v(" org.apache.skywalking.oap.server.starter.OAPServerStartUp \\\n        2>"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${OAP_LOG_DIR}")]),s._v('/oap.log 1> /dev/null &"')]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v(" -eq "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SkyWalking OAP started successfully!"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SkyWalking OAP started failure!"')]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("p",[s._v("配置IDEA  JVM Debug"),n("img",{attrs:{src:t(2430),alt:"img"}})]),s._v(" "),n("p",[s._v("查看CVE的修复commit寻找修复的地方")]),s._v(" "),n("p",[n("img",{attrs:{src:t(2431),alt:"img"}})]),s._v(" "),n("p",[s._v("打下断点并发送Payload请求包")]),s._v(" "),n("div",{staticClass:"language-php line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-php"}},[n("code",[n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("POST")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("graphql "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HTTP")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),s._v("\nHost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\nAccept"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" text"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("application"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("xhtml"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("xml"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("application"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("xml"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("q"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.9")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("image"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("avif"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("image"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("webp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("image"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("apng"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("q"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("application"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("signed"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("exchange"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("v"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("b3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("q"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.9")]),s._v("\nAccept"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Encoding"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" gzip"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" deflate\nAccept"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Language"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" zh"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CN")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("zh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("q"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.9")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("en"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("US")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("q"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("en"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("q"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.7")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("zh"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TW")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("q"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.6")]),s._v("\nCache"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Control"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" max"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("age"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nContent"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Type"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" application"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("json\nUpgrade"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Insecure"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Requests"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nUser"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Agent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Mozilla"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Macintosh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" Intel Mac "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("OS")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("X")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10_15_7")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" AppleWebKit"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("537.36")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("KHTML")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" like Gecko"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Chrome"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".4896")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".127")]),s._v(" Safari"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("537.36")]),s._v("\nContent"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Length"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("416")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[s._v('"query"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[s._v('"query queryData('),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$duration")])]),s._v(": Duration!) {globalP99: getLinearIntValues(metric: {name: \\\"all_p99\\\", id: \\\"') UNION ALL SELECT NULL,CONCAT('~', H2VERSION(), '~')--\\\" }, duration: "),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$duration")])]),s._v(') {  values { value } }}"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[s._v('"variables"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[s._v('"duration"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[s._v('"end"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[s._v('"2020-08-07 1418"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[s._v('"start"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[s._v('"2020-08-07 1417"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[s._v('"step"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[s._v('"MINUTE"')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("p",[n("img",{attrs:{src:t(2432),alt:"img"}})]),s._v(" "),n("p",[s._v("在 org.apache.skywalking.oap.query.graphql.resolver 中我们可以看到参数 metrics.getId() 没有过滤就直接传入 getLinearIntValues")]),s._v(" "),n("p",[n("img",{attrs:{src:t(2433),alt:"img"}})]),s._v(" "),n("p",[s._v("跟随来到 org.apache.skywalking.oap.server.core.query.MetricQueryService.getLinearIntValues(MetricQueryService.java:96)")]),s._v(" "),n("p",[n("img",{attrs:{src:t(2434),alt:"img"}})]),s._v(" "),n("p",[s._v("来到 org.apache.skywalking.oap.server.storage.plugin.jdbc.h2.dao.H2MetricsQueryDAO.getLinearIntValues(H2MetricsQueryDAO.java:117)，这里就将拼接的语句带入数据库进行查询，造成SQL注入")]),s._v(" "),n("p",[n("img",{attrs:{src:t(2435),alt:"img"}})]),s._v(" "),n("p",[s._v("调用栈如下")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[s._v("getLinearIntValues"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("117")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("H2MetricsQueryDAO")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("skywalking"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("oap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("storage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("plugin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("jdbc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("h2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dao"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ngetLinearIntValues"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("96")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MetricQueryService")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("skywalking"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("oap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("core"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("query"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ngetLinearIntValues"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MetricQuery")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("skywalking"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("oap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("query"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("graphql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("resolver"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nexecute"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("87")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("GraphQLQueryHandler")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("skywalking"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("oap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("query"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("graphql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ndoPost"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("81")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("GraphQLQueryHandler")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("skywalking"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("oap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("query"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("graphql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ndoPost"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("54")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JettyJsonHandler")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("skywalking"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("oap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("library"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("jetty"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nservice"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JettyJsonHandler")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("skywalking"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("oap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("library"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("jetty"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nservice"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("105")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JettyJsonHandler")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("skywalking"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("oap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("library"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("jetty"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])])],1)}),[],!1,null,null,null);a.default=e.exports}}]);